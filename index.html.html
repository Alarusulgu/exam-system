<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Examination System</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        // Lucide React Icons as inline SVG components
        const Clock = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <polyline points="12 6 12 12 16 14"></polyline>
            </svg>
        );

        const CheckCircle = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"></path>
                <polyline points="22 4 12 14.01 9 11.01"></polyline>
            </svg>
        );

        const XCircle = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="15" y1="9" x2="9" y2="15"></line>
                <line x1="9" y1="9" x2="15" y2="15"></line>
            </svg>
        );

        const AlertCircle = ({ className }) => (
            <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round">
                <circle cx="12" cy="12" r="10"></circle>
                <line x1="12" y1="8" x2="12" y2="12"></line>
                <line x1="12" y1="16" x2="12.01" y2="16"></line>
            </svg>
        );

        const ExamSystem = () => {
            const [view, setView] = useState('admin');
            const [examData, setExamData] = useState({
                title: '',
                duration: 30,
                questions: []
            });
            const [currentExam, setCurrentExam] = useState(null);
            const [answers, setAnswers] = useState({});
            const [timeRemaining, setTimeRemaining] = useState(0);
            const [examStarted, setExamStarted] = useState(false);
            const [results, setResults] = useState(null);
            const [studentName, setStudentName] = useState('');

            useEffect(() => {
                const sampleExam = {
                    title: 'Computer Science Fundamentals',
                    duration: 30,
                    questions: [
                        {
                            id: 1,
                            type: 'mcq',
                            question: 'What does HTML stand for?',
                            options: [
                                'Hyper Text Markup Language',
                                'High Tech Modern Language',
                                'Home Tool Markup Language',
                                'Hyperlinks and Text Markup Language'
                            ],
                            correctAnswer: 0,
                            points: 10
                        },
                        {
                            id: 2,
                            type: 'mcq',
                            question: 'Which data structure uses LIFO (Last In First Out)?',
                            options: ['Queue', 'Stack', 'Array', 'Tree'],
                            correctAnswer: 1,
                            points: 10
                        },
                        {
                            id: 3,
                            type: 'essay',
                            question: 'Explain the difference between procedural and object-oriented programming. Provide examples.',
                            points: 20,
                            keywords: ['procedural', 'object-oriented', 'oop', 'functions', 'classes', 'objects']
                        }
                    ]
                };
                setExamData(sampleExam);
            }, []);

            useEffect(() => {
                let interval;
                if (examStarted && timeRemaining > 0) {
                    interval = setInterval(() => {
                        setTimeRemaining(prev => {
                            if (prev <= 1) {
                                handleSubmitExam();
                                return 0;
                            }
                            return prev - 1;
                        });
                    }, 1000);
                }
                return () => clearInterval(interval);
            }, [examStarted, timeRemaining]);

            const addQuestion = (type) => {
                const newQuestion = {
                    id: Date.now(),
                    type,
                    question: '',
                    points: 10,
                    ...(type === 'mcq' ? {
                        options: ['', '', '', ''],
                        correctAnswer: 0
                    } : {
                        keywords: []
                    })
                };
                setExamData({
                    ...examData,
                    questions: [...examData.questions, newQuestion]
                });
            };

            const updateQuestion = (id, field, value) => {
                setExamData({
                    ...examData,
                    questions: examData.questions.map(q =>
                        q.id === id ? { ...q, [field]: value } : q
                    )
                });
            };

            const updateOption = (qId, optIndex, value) => {
                setExamData({
                    ...examData,
                    questions: examData.questions.map(q =>
                        q.id === qId ? {
                            ...q,
                            options: q.options.map((opt, i) => i === optIndex ? value : opt)
                        } : q
                    )
                });
            };

            const deleteQuestion = (id) => {
                setExamData({
                    ...examData,
                    questions: examData.questions.filter(q => q.id !== id)
                });
            };

            const startExam = () => {
                if (!studentName.trim()) {
                    alert('Please enter your name');
                    return;
                }
                setCurrentExam(examData);
                setTimeRemaining(examData.duration * 60);
                setExamStarted(true);
                setAnswers({});
                setView('exam');
            };

            const handleAnswerChange = (qId, answer) => {
                setAnswers({
                    ...answers,
                    [qId]: answer
                });
            };

            const calculateScore = () => {
                let totalScore = 0;
                let maxScore = 0;
                const questionResults = [];

                currentExam.questions.forEach(q => {
                    maxScore += q.points;
                    let scored = 0;
                    let correct = false;

                    if (q.type === 'mcq') {
                        correct = answers[q.id] === q.correctAnswer;
                        scored = correct ? q.points : 0;
                    } else {
                        const answer = (answers[q.id] || '').toLowerCase();
                        const keywordsFound = q.keywords.filter(kw =>
                            answer.includes(kw.toLowerCase())
                        );
                        const keywordScore = (keywordsFound.length / q.keywords.length) * q.points;
                        const lengthBonus = answer.length > 100 ? q.points * 0.2 : 0;
                        scored = Math.min(q.points, keywordScore + lengthBonus);
                    }

                    totalScore += scored;
                    questionResults.push({
                        ...q,
                        userAnswer: answers[q.id],
                        scored,
                        correct
                    });
                });

                return {
                    studentName,
                    totalScore: Math.round(totalScore),
                    maxScore,
                    percentage: Math.round((totalScore / maxScore) * 100),
                    questionResults,
                    completedAt: new Date().toLocaleString()
                };
            };

            const handleSubmitExam = () => {
                setExamStarted(false);
                const examResults = calculateScore();
                setResults(examResults);
                setView('results');
            };

            const formatTime = (seconds) => {
                const mins = Math.floor(seconds / 60);
                const secs = seconds % 60;
                return `${mins}:${secs.toString().padStart(2, '0')}`;
            };

            if (view === 'admin') {
                return (
                    <div className="min-h-screen bg-gray-50 p-6">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                                <h1 className="text-3xl font-bold text-gray-800 mb-6">Examination System - Admin Panel</h1>

                                <div className="space-y-4 mb-6">
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Exam Title</label>
                                        <input
                                            type="text"
                                            value={examData.title}
                                            onChange={(e) => setExamData({...examData, title: e.target.value})}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            placeholder="Enter exam title"
                                        />
                                    </div>

                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">Duration (minutes)</label>
                                        <input
                                            type="number"
                                            value={examData.duration}
                                            onChange={(e) => setExamData({...examData, duration: parseInt(e.target.value)})}
                                            className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                            min="1"
                                        />
                                    </div>
                                </div>

                                <div className="flex gap-4 mb-6">
                                    <button
                                        onClick={() => addQuestion('mcq')}
                                        className="flex-1 bg-blue-600 text-white px-4 py-2 rounded-lg hover:bg-blue-700 transition"
                                    >
                                        Add MCQ
                                    </button>
                                    <button
                                        onClick={() => addQuestion('essay')}
                                        className="flex-1 bg-green-600 text-white px-4 py-2 rounded-lg hover:bg-green-700 transition"
                                    >
                                        Add Essay Question
                                    </button>
                                </div>

                                {examData.questions.map((q, idx) => (
                                    <div key={q.id} className="border border-gray-200 rounded-lg p-4 mb-4">
                                        <div className="flex justify-between items-start mb-4">
                                            <h3 className="font-semibold text-gray-800">
                                                Question {idx + 1} ({q.type === 'mcq' ? 'Multiple Choice' : 'Essay'})
                                            </h3>
                                            <button
                                                onClick={() => deleteQuestion(q.id)}
                                                className="text-red-600 hover:text-red-700"
                                            >
                                                Delete
                                            </button>
                                        </div>

                                        <div className="space-y-3">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Question</label>
                                                <textarea
                                                    value={q.question}
                                                    onChange={(e) => updateQuestion(q.id, 'question', e.target.value)}
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                    rows="2"
                                                />
                                            </div>

                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Points</label>
                                                <input
                                                    type="number"
                                                    value={q.points}
                                                    onChange={(e) => updateQuestion(q.id, 'points', parseInt(e.target.value))}
                                                    className="w-32 px-3 py-2 border border-gray-300 rounded-lg"
                                                    min="1"
                                                />
                                            </div>

                                            {q.type === 'mcq' ? (
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">Options</label>
                                                    {q.options.map((opt, i) => (
                                                        <div key={i} className="flex items-center gap-2 mb-2">
                                                            <input
                                                                type="radio"
                                                                name={`correct-${q.id}`}
                                                                checked={q.correctAnswer === i}
                                                                onChange={() => updateQuestion(q.id, 'correctAnswer', i)}
                                                                className="w-4 h-4"
                                                            />
                                                            <input
                                                                type="text"
                                                                value={opt}
                                                                onChange={(e) => updateOption(q.id, i, e.target.value)}
                                                                className="flex-1 px-3 py-2 border border-gray-300 rounded-lg"
                                                                placeholder={`Option ${i + 1}`}
                                                            />
                                                        </div>
                                                    ))}
                                                </div>
                                            ) : (
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-1">
                                                        Keywords (comma-separated, for auto-grading)
                                                    </label>
                                                    <input
                                                        type="text"
                                                        value={q.keywords.join(', ')}
                                                        onChange={(e) => updateQuestion(q.id, 'keywords', e.target.value.split(',').map(k => k.trim()))}
                                                        className="w-full px-3 py-2 border border-gray-300 rounded-lg"
                                                        placeholder="procedural, object-oriented, classes"
                                                    />
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ))}
                            </div>

                            <div className="bg-white rounded-lg shadow-md p-6">
                                <h2 className="text-xl font-bold text-gray-800 mb-4">Student Login</h2>
                                <div className="space-y-4">
                                    <input
                                        type="text"
                                        value={studentName}
                                        onChange={(e) => setStudentName(e.target.value)}
                                        className="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                        placeholder="Enter your name"
                                    />
                                    <button
                                        onClick={startExam}
                                        disabled={examData.questions.length === 0}
                                        className="w-full bg-purple-600 text-white px-6 py-3 rounded-lg hover:bg-purple-700 transition disabled:bg-gray-400"
                                    >
                                        Start Exam
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'exam') {
                return (
                    <div className="min-h-screen bg-gray-50 p-6">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                                <div className="flex justify-between items-center mb-6">
                                    <div>
                                        <h1 className="text-2xl font-bold text-gray-800">{currentExam.title}</h1>
                                        <p className="text-gray-600">Student: {studentName}</p>
                                    </div>
                                    <div className="flex items-center gap-2 text-lg font-semibold">
                                        <Clock className={timeRemaining < 300 ? 'text-red-600' : 'text-blue-600'} />
                                        <span className={timeRemaining < 300 ? 'text-red-600' : 'text-blue-600'}>
                                            {formatTime(timeRemaining)}
                                        </span>
                                    </div>
                                </div>

                                {currentExam.questions.map((q, idx) => (
                                    <div key={q.id} className="border border-gray-200 rounded-lg p-6 mb-4">
                                        <div className="flex justify-between items-start mb-4">
                                            <h3 className="font-semibold text-gray-800 text-lg">
                                                Question {idx + 1}
                                            </h3>
                                            <span className="text-sm bg-blue-100 text-blue-800 px-3 py-1 rounded-full">
                                                {q.points} points
                                            </span>
                                        </div>

                                        <p className="text-gray-700 mb-4">{q.question}</p>

                                        {q.type === 'mcq' ? (
                                            <div className="space-y-2">
                                                {q.options.map((opt, i) => (
                                                    <label
                                                        key={i}
                                                        className="flex items-center gap-3 p-3 border border-gray-300 rounded-lg hover:bg-gray-50 cursor-pointer"
                                                    >
                                                        <input
                                                            type="radio"
                                                            name={`q-${q.id}`}
                                                            checked={answers[q.id] === i}
                                                            onChange={() => handleAnswerChange(q.id, i)}
                                                            className="w-4 h-4"
                                                        />
                                                        <span>{opt}</span>
                                                    </label>
                                                ))}
                                            </div>
                                        ) : (
                                            <textarea
                                                value={answers[q.id] || ''}
                                                onChange={(e) => handleAnswerChange(q.id, e.target.value)}
                                                className="w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500"
                                                rows="6"
                                                placeholder="Type your answer here..."
                                            />
                                        )}
                                    </div>
                                ))}

                                <button
                                    onClick={handleSubmitExam}
                                    className="w-full bg-green-600 text-white px-6 py-3 rounded-lg hover:bg-green-700 transition font-semibold"
                                >
                                    Submit Exam
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }

            if (view === 'results') {
                return (
                    <div className="min-h-screen bg-gray-50 p-6">
                        <div className="max-w-4xl mx-auto">
                            <div className="bg-white rounded-lg shadow-md p-6 mb-6">
                                <h1 className="text-3xl font-bold text-gray-800 mb-6">Exam Results</h1>

                                <div className="bg-blue-50 rounded-lg p-6 mb-6">
                                    <div className="grid grid-cols-2 gap-4 mb-4">
                                        <div>
                                            <p className="text-gray-600">Student Name</p>
                                            <p className="text-xl font-bold text-gray-800">{results.studentName}</p>
                                        </div>
                                        <div>
                                            <p className="text-gray-600">Completed At</p>
                                            <p className="text-xl font-bold text-gray-800">{results.completedAt}</p>
                                        </div>
                                    </div>
                                    <div className="border-t border-blue-200 pt-4">
                                        <p className="text-gray-600 mb-2">Final Score</p>
                                        <p className="text-4xl font-bold text-blue-600">
                                            {results.totalScore} / {results.maxScore}
                                        </p>
                                        <p className="text-2xl font-semibold text-gray-700 mt-2">
                                            {results.percentage}%
                                        </p>
                                    </div>
                                </div>

                                <h2 className="text-xl font-bold text-gray-800 mb-4">Detailed Results</h2>

                                {results.questionResults.map((q, idx) => (
                                    <div key={q.id} className="border border-gray-200 rounded-lg p-6 mb-4">
                                        <div className="flex justify-between items-start mb-3">
                                            <h3 className="font-semibold text-gray-800">Question {idx + 1}</h3>
                                            <div className="flex items-center gap-2">
                                                {q.type === 'mcq' ? (
                                                    q.correct ? (
                                                        <CheckCircle className="text-green-600" />
                                                    ) : (
                                                        <XCircle className="text-red-600" />
                                                    )
                                                ) : (
                                                    <AlertCircle className="text-blue-600" />
                                                )}
                                                <span className="font-semibold">
                                                    {q.scored} / {q.points} points
                                                </span>
                                            </div>
                                        </div>

                                        <p className="text-gray-700 mb-3">{q.question}</p>

                                        {q.type === 'mcq' ? (
                                            <div className="space-y-2">
                                                <div className="flex items-center gap-2">
                                                    <span className="font-medium text-gray-600">Your answer:</span>
                                                    <span className={q.correct ? 'text-green-600' : 'text-red-600'}>
                                                        {q.options[q.userAnswer] || 'Not answered'}
                                                    </span>
                                                </div>
                                                {!q.correct && (
                                                    <div className="flex items-center gap-2">
                                                        <span className="font-medium text-gray-600">Correct answer:</span>
                                                        <span className="text-green-600">{q.options[q.correctAnswer]}</span>
                                                    </div>
                                                )}
                                            </div>
                                        ) : (
                                            <div className="space-y-2">
                                                <div>
                                                    <span className="font-medium text-gray-600">Your answer:</span>
                                                    <div className="mt-2 p-3 bg-gray-50 rounded border border-gray-200">
                                                        {q.userAnswer || 'Not answered'}
                                                    </div>
                                                </div>
                                                <div>
                                                    <span className="font-medium text-gray-600">Expected keywords:</span>
                                                    <div className="flex flex-wrap gap-2 mt-2">
                                                        {q.keywords.map((kw, i) => (
                                                            <span key={i} className="px-2 py-1 bg-blue-100 text-blue-800 rounded text-sm">
                                                                {kw}
                                                            </span>
                                                        ))}
                                                    </div>
                                                </div>
                                            </div>
                                        )}
                                    </div>
                                ))}

                                <button
                                    onClick={() => {
                                        setView('admin');
                                        setResults(null);
                                        setStudentName('');
                                    }}
                                    className="w-full bg-blue-600 text-white px-6 py-3 rounded-lg hover:bg-blue-700 transition font-semibold"
                                >
                                    Return to Admin Panel
                                </button>
                            </div>
                        </div>
                    </div>
                );
            }
        };

        ReactDOM.render(<ExamSystem />, document.getElementById('root'));
    </script>
</body>
</html>